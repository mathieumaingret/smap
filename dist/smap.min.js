!function(o){"use strict";o.SMap=function(t,e){return this.elements={container:t},this.options={},this.map=void 0,this.markers={items:[],positions:[],cluster:void 0,iconInterface:void 0},o.extend(!0,this.options,o.SMap.defaults,e),!0===this.prepareOptions()&&this.init(),this},o.SMap.defaults={map:{center:void 0,zoom:10,minZoom:4,maxZoom:18,zoomPosition:"topright",gestureHandling:!0},autoCenter:!0,tileLayer:void 0,enableClusters:!0},o.SMap.prototype={prepareOptions:function(){return"undefined"==typeof L?(this.setLog("error",'"L" function from Leaflet is undefined'),!1):0===this.elements.container.length?(this.setLog("error","Map container not found"),!1):void 0===this.elements.container.attr("id")?(this.setLog("error",'Map container must have an "id" attribute'),!1):void 0===this.options.map.center||"object"!=typeof this.options.map.center?(this.setLog("error","Missing required center parameter as array"),!1):(void 0===this.options.tileLayer&&(this.options.tileLayer=L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://cartodb.com/attributions">CartoDB</a>'})),!0!==this.options.enableClusters||(L.enableClusters,!0)||(this.setLog("error","Missing markerClusterGroup library"),!1))},init:function(){this.map=L.map(this.elements.container.attr("id"),this.options.map),this.options.center=new L.LatLng(this.options.map.center[0],this.options.map.center[1]),this.setTileLayer(),this.setView(),this.initMarkerIcon()},update:function(){this.setView(),!0===this.options.autoCenter&&this.fitBounds(),this.leaflet().invalidateSize()},setView:function(){this.leaflet().setView(this.options.map.center,this.options.map.zoom),this.leaflet().zoomControl.setPosition(this.options.map.zoomPosition)},setTileLayer:function(){this.options.tileLayer.addTo(this.leaflet())},setCenter:function(t){"object"==typeof t?(this.options.map.center=t,this.options.center=new L.LatLng(this.options.map.center[0],this.options.map.center[1]),this.update()):this.setLog("error","Center must be an indexed array")},setZoom:function(t){this.options.map.zoom=t,this.update()},setMapOptions:function(t){"object"==typeof t?(o.extend(!0,this.options.map,t),o.extend(!0,this.leaflet().options,t),this.update()):this.setLog("error","Options must be an object")},fitBounds:function(){var t;t=this.markers.positions.length?this.markers.positions:[this.options.center],this.leaflet().fitBounds(t,{padding:[10,10]})},addMarkers:function(t,e){!0===e&&this.removeMarkers(),!0===this.options.enableClusters&&void 0===this.markers.cluster&&this.initMarkerCluster();for(var i=0,s=t.length;i<s;i++){t[i].cluster=this.markers.cluster;var r=new o.SMapMarker(t[i],this.markers.iconInterface);this.markers.items.push(r),this.markers.positions.push(r.getLatLng()),this.clusterEnabled()?this.markers.cluster.addLayer(r.leaflet()):r.leaflet().addTo(this.leaflet()),r.handleInteractions()}this.clusterEnabled()&&this.leaflet().addLayer(this.markers.cluster),this.update()},getMarkers:function(){return this.markers.items},removeMarkers:function(){var e=this,i=void 0===this.markers.cluster?"_icon":"_markerCluster";e.leaflet().eachLayer(function(t){void 0!==t[i]&&e.leaflet().removeLayer(t)}),this.markers.items=[],this.markers.positions=[],this.markers.cluster=void 0,this.update()},initMarkerCluster:function(){this.markers.cluster=L.markerClusterGroup()},initMarkerIcon:function(){this.markers.iconInterface=L.DivIcon.extend({createIcon:function(t){var e=L.DivIcon.prototype.createIcon.call(this,t);if(this.options.data)for(var i in this.options.data)e.dataset[i]=this.options.data[i];return e}})},setLog:function(t,e){console[t]("SMap : "+e)},clusterEnabled:function(){return void 0!==this.markers.cluster},leaflet:function(){return this.map}},o.fn.sMap=function(t){return new o.SMap(o(this),t)}}(jQuery);