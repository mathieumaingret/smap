!function(i){"use strict";i.SmapMarker=function(t,o){return this.elements={},this.options={cluster:void 0},this.marker=void 0,this.icon=void 0,this.iconInterface=o,this.popup=void 0,i.extend(!0,this.options,i.SmapMarker.defaults,t),this.prepareOptions()&&this.init(),this},i.SmapMarker.defaults={position:void 0,customIcon:!0,icon:{html:void 0,data:{id:void 0},iconSize:[50,50],iconAnchor:[],popupAnchor:[]},popup:void 0,showPopup:!1,centerOnFocus:!0,sourceContainer:void 0,classes:{prefix:"marker",marker:"{prefix}--default",popup:"{prefix}-popup",focused:"is-focused",active:"is-active"}},i.SmapMarker.prototype={prepareOptions:function(){var e=this;return"undefined"==typeof L?(e.setLog("error",'"L" function from Leaflet is undefined'),!1):void 0===e.options.position||"object"!=typeof e.options.position?(e.setLog("error","Missing required position parameter as array"),!1):(0===e.options.icon.iconAnchor.length&&(e.options.icon.iconAnchor=[Math.floor(e.options.icon.iconSize[0]/2),e.options.icon.iconSize[1]]),0===e.options.icon.popupAnchor.length&&(e.options.icon.popupAnchor=[0,-Math.floor(e.options.icon.iconSize[1]/1.5)]),i.each(e.options.classes,function(t,o){"string"==typeof o&&(e.options.classes[t]=o.replace(/{prefix}/,e.options.classes.prefix)),e.options.icon.className=e.options.classes.prefix+" "+e.options.classes.marker}),!0)},init:function(){var t={};!0===this.options.customIcon&&(this.icon=new this.iconInterface(this.options.icon),t.icon=this.icon),this.marker=L.marker(this.options.position,t),!0===this.options.customIcon&&void 0!==this.options.icon.html&&this.getContainer().html(this.options.icon.html),this.managePopup()},managePopup:function(){var t=this;if(void 0!==t.options.popup){"object"==typeof t.options.popup&&t.options.popup.html();var o=i("<div>",{class:t.options.classes.popup,html:t.options.popup});t.popup=t.leaflet().bindPopup(o.prop("outerHTML"))}},handleInteractions:function(){var t=this;!0===t.options.showPopup&&t.leaflet().openPopup(),this.leaflet().on({click:function(){!0===t.options.centerOnFocus&&t.map().setView(t.leaflet().getLatLng())},mouseover:function(){t.getContainer().addClass(t.options.classes.focused)},mouseout:function(){t.getContainer().removeClass(t.options.classes.focused)},popupopen:function(){t.getContainer().addClass(t.options.classes.active),void 0!==t.options.sourceContainer&&t.options.sourceContainer.addClass(t.options.classes.active)},popupclose:function(){t.getContainer().removeClass(t.options.classes.active),void 0!==t.options.sourceContainer&&t.options.sourceContainer.removeClass(t.options.classes.active)}}),void 0!==t.options.sourceContainer&&t.options.sourceContainer.on("click",null,function(){!0===t.options.centerOnFocus&&void 0!==t.options.cluster&&t.options.cluster.zoomToShowLayer(t.leaflet()),t.leaflet().openPopup()})},getPosition:function(){return this.options.position},getLatLng:function(){return this.leaflet().getLatLng()},getContainer:function(){return i(this.leaflet()._icon)},setLog:function(t,o){console[t]("SmapMarker : "+o)},leaflet:function(){return this.marker},map:function(){return this.leaflet()._map}}}(jQuery),function(n){"use strict";n.Smap=function(t,o){return this.elements={container:t},this.options={},this.map=void 0,this.markers={items:[],positions:[],cluster:void 0,iconInterface:void 0},n.extend(!0,this.options,n.Smap.defaults,o),!0===this.prepareOptions()&&this.init(),this},n.Smap.defaults={map:{center:void 0,zoom:10,minZoom:4,maxZoom:18,zoomPosition:"topright",gestureHandling:!0},autoCenter:!0,tileLayer:void 0,enableClusters:!0},n.Smap.prototype={prepareOptions:function(){return"undefined"==typeof L?(this.setLog("error",'"L" function from Leaflet is undefined'),!1):0===this.elements.container.length?(this.setLog("error","Map container not found"),!1):void 0===this.elements.container.attr("id")?(this.setLog("error",'Map container must have an "id" attribute'),!1):void 0===this.options.map.center||"object"!=typeof this.options.map.center?(this.setLog("error","Missing required center parameter as array"),!1):(void 0===this.options.tileLayer&&(this.options.tileLayer=L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://cartodb.com/attributions">CartoDB</a>'})),!0!==this.options.enableClusters||!0||(this.setLog("error","Missing markerClusterGroup library"),!1))},init:function(){this.map=L.map(this.elements.container.attr("id"),this.options.map),this.options.center=new L.LatLng(this.options.map.center[0],this.options.map.center[1]),this.setTileLayer(),this.setView(),this.initMarkerIcon()},update:function(){this.setView(),!0===this.options.autoCenter&&this.fitBounds(),this.leaflet().invalidateSize()},setView:function(){this.leaflet().setView(this.options.map.center,this.options.map.zoom),this.leaflet().zoomControl.setPosition(this.options.map.zoomPosition)},setTileLayer:function(){this.options.tileLayer.addTo(this.leaflet())},setCenter:function(t){"object"==typeof t?(this.options.map.center=t,this.options.center=new L.LatLng(this.options.map.center[0],this.options.map.center[1]),this.update()):this.setLog("error","Center must be an indexed array")},setZoom:function(t){this.options.map.zoom=t,this.update()},setMapOptions:function(t){"object"==typeof t?(n.extend(!0,this.options.map,t),n.extend(!0,this.leaflet().options,t),this.update()):this.setLog("error","Options must be an object")},fitBounds:function(){var t;t=this.markers.positions.length?this.markers.positions:[this.options.center],this.leaflet().fitBounds(t,{padding:[10,10]})},addMarkers:function(t,o){!0===o&&this.removeMarkers(),!0===this.options.enableClusters&&void 0===this.markers.cluster&&this.initMarkerCluster();for(var e=0,i=t.length;e<i;e++){t[e].cluster=this.markers.cluster;var s=new n.SmapMarker(t[e],this.markers.iconInterface);this.markers.items.push(s),this.markers.positions.push(s.getLatLng()),this.clusterEnabled()?this.markers.cluster.addLayer(s.leaflet()):s.leaflet().addTo(this.leaflet()),s.handleInteractions()}this.clusterEnabled()&&this.leaflet().addLayer(this.markers.cluster),this.update()},getMarkers:function(){return this.markers.items},removeMarkers:function(){var o=this,e=void 0===this.markers.cluster?"_icon":"_markerCluster";o.leaflet().eachLayer(function(t){void 0!==t[e]&&o.leaflet().removeLayer(t)}),this.markers.items=[],this.markers.positions=[],this.markers.cluster=void 0,this.update()},initMarkerCluster:function(){this.markers.cluster=L.markerClusterGroup()},initMarkerIcon:function(){this.markers.iconInterface=L.DivIcon.extend({createIcon:function(t){var o=L.DivIcon.prototype.createIcon.call(this,t);if(this.options.data)for(var e in this.options.data)o.dataset[e]=this.options.data[e];return o}})},setLog:function(t,o){console[t]("Smap : "+o)},clusterEnabled:function(){return void 0!==this.markers.cluster},leaflet:function(){return this.map}},n.fn.smap=function(t){return new n.Smap(n(this),t)}}(jQuery);